import { Disklet, navigateDisklet } from '../index'

export function dumpData(disklet: Disklet): Promise<any> {
  const json: any = {}
  return disklet.list().then(listing => {
    return Promise.all(
      Object.keys(listing).map(path => {
        const type = listing[path]
        if (type === 'folder') {
          return dumpData(navigateDisklet(disklet, path)).then(folderData => {
            json[path] = folderData
          })
        }
        if (type === 'file') {
          return disklet.getText(path).then(data => {
            json[path] = JSON.parse(data)
          })
        }
      })
    ).then(() => json)
  })
}
